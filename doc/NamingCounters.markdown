# PrivCount Counter Names

The names of the PrivCount counters are used when communicating between nodes.

## Node Agreement

The Tally Server and all Data Collectors in the network must agree on the
counter names they intend to use. Share Keepers will store shares for any
counter name, even if it was added in a later version.
(The tor patch does not know any counter names: the PrivCount python code maps
each counter to the events it uses, and processes events to increment
counters.)

If new counters are added, they can not be reported by Data Collectors until
the Tally Server upgrades to a version that has them listed as valid counters.

If old counters are removed, all Data Collectors must stop reporting them
before the Tally Server can upgrade (or downgrade) to a version that stops
recognising them as valid counters.

## Naming PrivCount Counters

### Legal Counter Names

PrivCount counter names consist of one or more ASCII characters in the set:
* A-Za-z0-9

This set of characters is enforced by test/test_counter_match.sh

The autogenerated counters in the Traffic Model also use the characters:
* _+-

The Traffic Model template counter names are ignored by
test/test_counter_match.sh

### Naming Standards

PrivCount counters should be named using a consistent format.
This format makes it easier to work out what each counter is counting.

The most important rule is:
* counters should be named after what they count, not how they are used
  (we can change what we use a counter for, but if we change what it counts,
  it is really a different counter)

Other general rules:
* Each name consists of a root descriptive word, one or more qualifiers, and a
  word that describes the type of counter.
* Names read like English sentences, starting with "This is a/an/the..."
* Qualifiers generally come before the noun they modify, but follow normal
  English usage as much as possible.
* We don't repeat words in a name.
* We don't use plurals or words like "Total" or "All". They don't add anything
  to the meaning of the name. (But they do lead to inconsistent names.)

#### A Pattern for PrivCount Counter Names

Here is how you can construct a PrivCount counter name:
* Entry/NonEntry/Exit/HSDir{2,3}/
* Active/Inactive/ (order varies: before the noun it qualifies)
* Interactive/OtherPort/P2P/Web/ (order varies: before the noun it qualifies)
* Connection/Circuit/Stream/ClientIP/Store/Zero
* Inbound/Outbound/Inter/ (prefer later if order is ambiguous)
* Circuit/Stream/TrafficModel/Intro/Descriptor/Upload/Revision/
* Add/Reject/
* (Cache Reason String)/
* Cached/Uncached/ (only if not implied by the cache reason)
* ClientAuth/NoClientAuth/
* Cell/Byte/Creation/Life/Emission/Transition/{SquaredLog,Log,}Delay/Point/
* Count/Histogram/Ratio/Time

A trailing slash means that the item is optional.

For counters introduced or renamed in PrivCount 1.0.0, we used Count for
histograms and single bin counters. In later versions, we use Histogram for
multi-bin counters, and Count for single bin counters.

Ratio and Time are always histograms.

#### Suffixes for PrivCount Traffic Model Counters

The autogenerated Traffic Model counters have a suffix with
underscore-separated state and direction qualifiers.

See CounterDefinitions.markdown for details.

## Using PrivCount Counters

Counters must be referenced using a particular format so they are easy to
check for consistency.

### Source Code
* One counter per line (other code can appear on that line)
* In single quotes ''
* Following the existing format

### Tests

* One counter per line (no other declarations on that line)
* Followed by a colon :
* Following the existing format
